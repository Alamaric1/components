use ::components/ui/unbound/DockingFramework.bbj::FrameList
use ::components/ui/unbound/DockingFramework.bbj::FrameSet
use ::components/ui/unbound/DockingFramework.bbj::FrameCell

class public DockingTabsComponent

    field private BBjWindow ParentWnd!
    field private BBjChildWindow Wnd!
    field private BBjNumber X
    field private BBjNumber Y
    field private BBjNumber W
    field private BBjNumber H

    field private BBjVector TitleList!
    field private BBjVector TabsList!
    field private BBjVector FrameCellList!

    field private BBjNumber Selected
    field private BBjNumber TabsLen

    field private FrameList FrameList!
    field private FrameSet FrameSet!



    field private BBjNumber EventEater
    field private BBjNumber IsDragging
    field private BBjNumber DragOffsX
    field private BBjNumber DragOffsY

    field private static BBjImage ImgTabSelM! = BBjAPI().getSysGui().getImageManager().loadImageFromBytes($FFD8FFE000104A46494600010101006000600000FFDB00430006040506050406060506070706080A100A0A09090A140E0F0C1017141818171416161A1D251F1A1B231C1616202C20232627292A29191F2D302D283025282928FFDB0043010707070A080A130A0A13281A161A2828282828282828282828282828282828282828282828282828282828282828282828282828282828282828282828282828FFC00011080017000403012200021101031101FFC40017000100030000000000000000000000000000030407FFC4001D100100010305000000000000000000000000020553A212131661D1FFC4001501010100000000000000000000000000000304FFC4001F1100010206030000000000000000000000000102030412131415515253FFDA000C03010002110311003F00DE78D52ED631F05FDDEC4FA693F34173A3F7521D11BB8807BCFE42A1A7FFD9$)
    field private static BBjImage ImgTabSelR! = BBjAPI().getSysGui().getImageManager().loadImageFromBytes($FFD8FFE000104A46494600010101006000600000FFDB00430006040506050406060506070706080A100A0A09090A140E0F0C1017141818171416161A1D251F1A1B231C1616202C20232627292A29191F2D302D283025282928FFDB0043010707070A080A130A0A13281A161A2828282828282828282828282828282828282828282828282828282828282828282828282828282828282828282828282828FFC00011080017000203012200021101031101FFC400160001010100000000000000000000000000000604FFC4002210000104020007010000000000000000000300010204051106121431355273B1FFC40014010100000000000000000000000000000004FFC4001F1100010303050000000000000000000000010002030451911112131421FFDA000C03010002110311003F00B5B596BE0B2608AD9A231CDE118F376667D3322C391F216BEB2FD744F14D08F03060209A8949D771CAB2B1C18031C857CA4E2F393CB5D36F5B7DFBA2220F664BA5F032CBFFD9$)
    field private static BBjImage ImgTabSelL! = BBjAPI().getSysGui().getImageManager().loadImageFromBytes($FFD8FFE000104A46494600010101006000600000FFDB00430006040506050406060506070706080A100A0A09090A140E0F0C1017141818171416161A1D251F1A1B231C1616202C20232627292A29191F2D302D283025282928FFDB0043010707070A080A130A0A13281A161A2828282828282828282828282828282828282828282828282828282828282828282828282828282828282828282828282828FFC00011080017000503012200021101031101FFC40017000100030000000000000000000000000000030407FFC400201000020202020203000000000000000000010200050304125111214174B2FFC40014010100000000000000000000000000000003FFC4001C1101000203000300000000000000000000010002030411052132FFDA000C03010002110311003F00DC2B287436EB353676559F367C4B91D9829258804FB23B312FD3BF1A0ABFAE9F91101F0FA6AAE3221BD9F9F6C82A0AB5156AF3F0575D3E3B511111ED96E2FB855A1C27FFD9$)

    field private static BBjImage ImgTabL! = BBjAPI().getSysGui().getImageManager().loadImageFromBytes($FFD8FFE000104A46494600010101006000600000FFDB00430006040506050406060506070706080A100A0A09090A140E0F0C1017141818171416161A1D251F1A1B231C1616202C20232627292A29191F2D302D283025282928FFDB0043010707070A080A130A0A13281A161A2828282828282828282828282828282828282828282828282828282828282828282828282828282828282828282828282828FFC00011080017000503012200021101031101FFC40017000100030000000000000000000000000000030408FFC4001F10000202020203010000000000000000000103020400051121233174B2FFC400160101010100000000000000000000000000010002FFC400191100030003000000000000000000000000000102111221FFDA000C03010002110311003F00D05A3D5EB9FA6A2EB146B39CD4C18C635427294A4012493DFB38C9B413E345ADF997F918CAA9E5F42656170A551566AD54D75EC2B982A115C4CA94B9200E3BF2E318CC6EC7547FFFD9$)
    field private static BBjImage ImgTabM! = BBjAPI().getSysGui().getImageManager().loadImageFromBytes($FFD8FFE000104A46494600010101006000600000FFDB00430006040506050406060506070706080A100A0A09090A140E0F0C1017141818171416161A1D251F1A1B231C1616202C20232627292A29191F2D302D283025282928FFDB0043010707070A080A130A0A13281A161A2828282828282828282828282828282828282828282828282828282828282828282828282828282828282828282828282828FFC00011080017000503012200021101031101FFC40017000100030000000000000000000000000000040508FFC4001E1000010304030000000000000000000000000204120515549455D1D3FFC400160101010100000000000000000000000000020001FFC40017110003010000000000000000000000000000011251FFDA000C03010002110311003F00D1F66A4F18C75D1D0244C069E94AC2A64EF3DB692BD4001B66CA3FFFD9$)
    field private static BBjImage ImgTabR! = BBjAPI().getSysGui().getImageManager().loadImageFromBytes($FFD8FFE000104A46494600010001006000600000FFFE001F4C45414420546563686E6F6C6F6769657320496E632E2056312E303100FFDB0084000505050805080C07070C0C0909090C0D0C0C0C0C0D0D0D0D0D0D0D0D0D0D0D0D0D0D0D0D0D0D0D0D0D0D0D0D0D0D0D0D0D0D0D0D0D0D0D0D0D0D0D0D0D0D0D0D010508080A070A0C07070C0D0C0A0C0D0D0D0D0D0D0D0D0D0D0D0D0D0D0D0D0D0D0D0D0D0D0D0D0D0D0D0D0D0D0D0D0D0D0D0D0D0D0D0D0D0D0D0D0D0D0D0D0D0DFFC401A20000010501010101010100000000000000000102030405060708090A0B0100030101010101010101010000000000000102030405060708090A0B100002010303020403050504040000017D01020300041105122131410613516107227114328191A1082342B1C11552D1F02433627282090A161718191A25262728292A3435363738393A434445464748494A535455565758595A636465666768696A737475767778797A838485868788898A92939495969798999AA2A3A4A5A6A7A8A9AAB2B3B4B5B6B7B8B9BAC2C3C4C5C6C7C8C9CAD2D3D4D5D6D7D8D9DAE1E2E3E4E5E6E7E8E9EAF1F2F3F4F5F6F7F8F9FA1100020102040403040705040400010277000102031104052131061241510761711322328108144291A1B1C109233352F0156272D10A162434E125F11718191A262728292A35363738393A434445464748494A535455565758595A636465666768696A737475767778797A82838485868788898A92939495969798999AA2A3A4A5A6A7A8A9AAB2B3B4B5B6B7B8B9BAC2C3C4C5C6C7C8C9CAD2D3D4D5D6D7D8D9DAE2E3E4E5E6E7E8E9EAF2F3F4F5F6F7F8F9FAFFC00011080017000303011100021101031101FFDA000C03010002110311003F00F52F10DDCFA56A135ADA492470A1055559828DEAB2100280A06E63803A77E6BAA351B5738DD349D883C5ADFF001359FF00ED9FFE8A4ACE0D28AFEBA9AC93BB3A6D4BC32351B87B996E955DF6E42DB3E3E550A31FE95E80563CC6BCA7FFD9$)

    field private static BBjImage ImgTabBar! = BBjAPI().getSysGui().getImageManager().loadImageFromBytes($FFD8FFE000104A46494600010101006000600000FFDB00430001010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101FFDB00430101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101FFC00011080005000103012200021101031101FFC400150001010000000000000000000000000000000AFFC4001B100100000700000000000000000000000000060708175597D7FFC4001501010100000000000000000000000000000405FFC40021110001010705000000000000000000000002000103516192B1D10412145254FFDA000C03010002110311003F00AE1B7F2FB111CEFBA84EA4013CCD57A1F565995E2D56B71773A8B32BC5ABFFD9$)

    field private static BBjImage ImgClose! = BBjAPI().getSysGui().getImageManager().loadImageFromBytes($FFD8FFE000104A46494600010101006000600000FFDB00430001010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101FFDB00430101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101FFC00011080008000803012200021101031101FFC4001500010100000000000000000000000000000007FFC4001D100002020203010000000000000000000004060305000201070809FFC40014010100000000000000000000000000000009FFC4001F1100020300010501000000000000000000010203040512001113142223FFDA000C03010002110311003F009BF9CD6BC8F73F3ED1A7B757EB7D5A21E8B52E4A6089787AF55D53C458463DA376FDA19A0DCFECAE4915EA482D46AC9944A4F2A6A973D2D5FCBAF2E818C6253115C1CFCE11471E8AE9558744AEB20BAB49A782BF7A99E078BD6A31F1FCABFDF1EEC4BB1627A3E9C3EE686919669A8367DB973C365C86A35C586C4A45BBE4897D8BD2733E5B1F1C8050100503AFFFD9$)



    method private DockingTabsComponent()


    methodend



    method public DockingTabsComponent(BBjNumber x, BBjNumber y, BBjNumber w, BBjNumber h, FrameList frameList!, FrameSet frameSet!)

        #ParentWnd! = frameset!.getWnd()
        id = #ParentWnd!.getAvailableControlID()

        #Wnd! = #ParentWnd!.addChildWindow(id,x+7,y+4,w-7,h-4,$$,$00000800$,BBjAPI().getSysGui().getAvailableContext())
        i! = #Wnd!.addImageCtrl(5,0,27,w,5,#ImgTabBar!)

        rem #Wnd!.setBackColor(BBjAPI().makeColor("YELLOW"))
        #X = x
        #Y = y
        #W = w
        #H = h

        #TitleList! = new BBjVector()
        #TabsList! = new BBjVector()
        #FrameCellList! = new BBjVector()

        #FrameList! = frameList!
        #FrameSet! = frameSet!

    methodend

    method public void clear()

        if #TabsList!.size() then

            for i=0 to #TabsList!.size()-1

                w! = #TabsList!.getItem(i)
                w!.destroy()
                w! = null()

            next

        fi

        #TabsList!.clear()
        #TitleList!.clear()
        #FrameCellList!.clear()
        #Selected=0

    methodend


    method public void destroy()

        #clear()
        #Wnd!.destroy()
        #Wnd! = null()

    methodend

    method public void onTabMouseUp(BBjMouseUpEvent ev!)

        #IsDragging=0
        #ParentWnd!.setCursor(0)

        fc! = #FrameCellList!.getItem(#Selected)

        #FrameSet!.notifyDropTab(fc!)

    methodend


    method public void onTabMouseMove(BBjMouseMoveEvent ev!)



        if #IsDragging then

            if mod(#EventEater,10)=0 then

                #EventEater=0
                #ParentWnd!.setCursor(1)



                #FrameSet!.notifyDragTab(ev!.getX()+#DragOffsX,ev!.getY()+#DragOffsY)

            else
                #EventEater=#EventEater+1
            fi


        fi

    methodend


    method public void onTabMouseEnter(BBjMouseEnterEvent ev!)

        BBjAPI().getSysGui().getWindow(ev!.getControl().getContextID()).getControl(300).setVisible(1)

    methodend

    method public void onTabMouseExit(BBjMouseExitEvent ev!)

        rem BBjAPI().getSysGui().getWindow(ev!.getControl().getContextID()).getControl(300).setVisible(0)

    methodend

    method public void onTabMouseDownDrag(BBjMouseDownEvent ev!)

        #onTabMouseDown(ev!)

        #DragOffsX = #Wnd!.getX()+ev!.getX()+ev!.getChildWindow().getX()
        #DragOffsY = #Wnd!.getY()+ev!.getY()+ev!.getChildWindow().getY()
        #IsDragging=1

    methodend

    method public void onTabMouseDown(BBjMouseDownEvent ev!)

        id = ev!.getChildWindow().getID()-100

        if id <> #Selected then

            #renderSelected(#Selected,0)
            #Selected=id
            #renderSelected(#Selected,1)
            #FrameList!.notifySelectionChange(id)

        fi


    methodend

    method public void onTbClose(BBjToolButtonPushEvent ev!)

        id=BBjAPI().getSysGui().getWindow(ev!.getControl().getContextID()).getID()-100
        #FrameList!.closeTab(id)


    methodend

    method private void renderSelected(BBjNumber tabID, BBjNumber selected)


        cw! = #TabsList!.getItem(tabID)

        if selected then
            cw!.getControl(11).setImage(#ImgTabSelL!)
            cw!.getControl(12).setImage(#ImgTabSelM!)
            cw!.getControl(13).setImage(#ImgTabSelR!)
        else
            cw!.getControl(11).setImage(#ImgTabL!)
            cw!.getControl(12).setImage(#ImgTabM!)
            cw!.getControl(13).setImage(#ImgTabR!)
        fi



    methodend

    method public void addTab(FrameCell frameCell!)

        i=#TabsList!.size()


        Title$=frameCell!.getTitle()
        TextWidth = max(80,len(Title$)*7)

        cw! = #Wnd!.addChildWindow(100+i,#TabsLen,8,TextWidth,#H,$$,$00000800$,BBjAPI().getSysGui().getAvailableContext())


        if i=#Selected then
            cw!.addImageCtrl(11,0,0,5,23,#ImgTabSelL!)
            i!=cw!.addImageCtrl(12,5,0,TextWidth-7,23,#ImgTabSelM!)
            cw!.addImageCtrl(13,TextWidth-3,0,3,23,#ImgTabSelR!)
        else
            cw!.addImageCtrl(11,0,0,5,23,#ImgTabL!)
            i!=cw!.addImageCtrl(12,5,0,TextWidth-7,23,#ImgTabM!)
            cw!.addImageCtrl(13,TextWidth-3,0,3,23,#ImgTabR!)
        fi


        st!=cw!.addStaticText(10,10,5,TextWidth+20,20,Title$)
        st!.setOpaque(0)

        #TabsList!.addItem(cw!)
        #TitleList!.addItem(Title$)
        #FrameCellList!.addItem(frameCell!)


        rem /* Switch the event trigger methods depending on the tab drag & drop status
        rem  * Buggy/not possible to attach more than one callback on an element/event combo
        rem  */

        if frameCell!.isAllowTabDrag() then
            cw!.setCallback(BBjAPI.ON_MOUSE_DOWN, #this!,  "onTabMouseDownDrag")
            cw!.setCallback(BBjAPI.ON_MOUSE_UP,   #this!,  "onTabMouseUp")
            cw!.setCallback(BBjAPI.ON_MOUSE_MOVE, #this!,  "onTabMouseMove")
        else
            cw!.setCallback(BBjAPI.ON_MOUSE_DOWN, #this!,  "onTabMouseDown")


        fi

        if frameCell!.isShowClose() then
            btn! = cw!.addToolButton(300,TextWidth-16,2,12,12,"")
            btn!.setImage(#ImgClose!)
            btn!.setCallback(BBjAPI.ON_TOOL_BUTTON_PUSH,#this!,"onTbClose")
        fi


        #TabsLen=#TabsLen+TextWidth

    methodend

    method public BBjNumber getSelectedTabId()

        methodret #Selected

    methodend


classend












